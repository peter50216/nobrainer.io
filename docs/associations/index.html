<!doctype html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Associations · NoBrainer</title>
  <link rel="stylesheet" href="/css/screen.css" />
</head>

<body class="wrap">
  <header>
  <div class="grid">
    <div class="unit one-fifth"> </div>
    <div class="unit four-fifths">
      <h1> <a href="/"> <span>NoBrainer</span> </a> </h1>
      <h3>A Ruby ORM for RethinkDB</h3>
    </div>
  </div>

<!-- put back when we do it properly for mobiles -->
<!-- <a href="https://github.com/nviennot/nobrainer"><img style="position: absolute; top: 0; right:0; border: 0; width: 149px; height: 149px;" src="/img/forkme.png" alt="Fork me on GitHub"></a> -->

</header>


  <section class="docs">
  <div class="grid">

    <div class="unit one-fifth">
  <aside>
    <h4>Getting Started</h4> 

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/introduction/">Introduction</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/installation/">Installation</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/differences_from_other_orms/">Differences from other ORMs</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Models</h4>          

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/models/">Models</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/fields/">Fields</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/types/">Types</a></li>
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/timestamps/">Timestamps</a></li>
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/serialization/">Serialization</a></li>
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/persistence/">Persistence</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/callbacks/">Callbacks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/validations/">Validations</a></li>
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/dirty_tracking/">Dirty Tracking</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
      <li class="current"><a href="/docs/associations/">Associations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Querying</h4>        

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/querying/">Querying</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/scopes/">Scopes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/joins/">Joins</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/eager_loading/">Eager Loading</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Advanced Topics</h4> 

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/rql_layer/">RQL Layer</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/indexes/">Indexes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/atomic_ops/">Atomic Operations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/distributed_locks/">Distributed Locks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/db_management/">DB Management</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/table_configuration/">Table Configuration</a></li>
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/multi_tenancy/">Multi Tenancy</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/caching/">Caching</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/event_machine/">Event Machine</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Recipes</h4>         

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/real_time_tutorial/">Real Time Tutorial</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Miscellaneous</h4>   

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/roadmap/">Roadmap</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/changelog/">Changelog</a></li>
    
  


  

  
    
  

  
    
  
    
      <li class=""><a href="/docs/3rd_party_integration/">3rd-party Integration</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/communication/">Communication</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/faq/">FAQ</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/credits/">Credits</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

  </aside>
</div>


    <div class="like-buttons">
      <div class="github">
        <iframe src="/github-btn.html?user=nviennot&repo=nobrainer&type=watch&count=true"
          allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>
      </div>

      <div class="twitter">
        <a href="https://twitter.com/nviennot" class="twitter-follow-button" data-show-count="false" data-lang="en">Follow @nviennot</a>
       <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      </div>

    </div>

    <div class="unit four-fifths">
      <article>
        <h1>Associations</h1>
        
<h2 id="associations">Associations</h2>

<p>NoBrainer supports <code>belongs_to</code> and <code>has_many</code> associations.</p>

<p>NoBrainer is different from other ORMs: <code>has_many</code> associations are not writable because writable <code>has_many</code> associations are leaky abstractions and provide hard to understand semantics. Therefore there is no <code>has_and_belongs_to</code> associations.</p>

<p>Remember that NoBrainer never saves a model instance under the covers.</p>

<p>In this section, the owner refers to the model where the association is declared, and the target refers to the other side of the association.</p>

<h2 id="belongs_to_association">belongs_to Association</h2>

<p>The <code>belongs_to</code> syntax is the following: <code>belongs_to :target, options</code></p>

<p>The following describes the different options <code>belongs_to</code> accepts:</p>

<ul>
<li><code>:primary_key</code>: the primary key to use on the target. Defaults to <code>:id</code>.</li>

<li><code>:foreign_key</code>: the foreign key to use. Defaults to <code>#{target_name}_#{primary_key}</code>.</li>

<li><code>:foreign_key_as</code>: the alias for the foreign key. Defaults to <code>nil</code>.</li>

<li><code>:class_name</code>: the target class name. Defaults to <code>Target</code>.</li>

<li><code>:index</code>: when true, the foreign key field gets an index declared to speed to the corresponding <code>has_many</code> association. Defaults to <code>nil</code>.</li>

<li><code>:validates</code>: passes a validation to <code>target</code>, and not <code>target_id</code>. Useful to provide a presence validation.</li>

<li><code>:required</code>: a shorthand for <code>:validates =&gt; { :presence =&gt; true }</code>.</li>

<li><code>:uniq</code> (or <code>:unique</code>): a shorthand to specify a uniquness validation on the foreign key.</li>
</ul>

<p>The following describes the behavior of <code>belongs_to</code> associations:</p>

<ul>
<li><code>owner.target</code> looks up the target instance by performing <code>Target.find(owner.foreign_key)</code>. The result is cached regardless if the target is found or not.</li>

<li><code>owner.target=(value)</code> sets <code>owner.foreign_key = value.primary_key</code>, and caches the value.</li>

<li><code>owner.foreign_key=(value)</code> sets the foreign key and kills the target cache.</li>
</ul>

<p>NoBrainer will always insert an <code>after_validation</code> callback to check that if there is a target set, then it must be <code>persisted?</code>. If the target is not persisted, NoBrainer will raise a <code>NoBrainer::Error::AssociationNotPersisted</code> exception.</p>

<p>You can read more about how presence validations are handled on belongs_to associations in the <a href="/docs/validations#presence_validations_on_belongs_to_associations">validations section</a>.</p>

<h2 id="has_many_association">has_many Association</h2>

<p>The <code>has_many</code> syntax is the following: <code>has_many :targets, options</code></p>

<p>The following describes the different options <code>has_many</code> accepts:</p>

<ul>
<li><code>:primary_key</code>: the primary key to use. Defaults to the owner’s primary key.</li>

<li><code>:foreign_key</code>: the foreign key that the targets use. Defaults to <code>#{owner_name}_#{primary_key}</code>.</li>

<li><code>:class_name</code>: the targets class name. Defaults to <code>Target</code>.</li>

<li><code>:dependent</code>: configure the destroy behavior further explained below. Defaults to <code>nil</code>.</li>

<li><code>:through</code>: See the <code>has_many through</code> association below.</li>

<li><code>:scope</code>: A lambda that evaluates to a criteria which gets applied to the query. This lambda is evaluated in the context of the <code>Target</code> class, which means that using named scoped defined on <code>Target</code> is possible.</li>
</ul>

<p>The dependent option tells what to do when destroying an owner that has many targets with a <code>before_destroy</code> callback. The different dependent values are:</p>

<ul>
<li><code>nil</code>: do nothing</li>

<li><code>:destroy</code>: <code>destroy_all</code> the targets.</li>

<li><code>:delete</code>: <code>delete_all</code> the targets.</li>

<li><code>:nullify</code>: <code>update_all</code> the targets’ foreign keys to <code>nil</code>.</li>

<li><code>:restrict</code>: raises a <code>NoBrainer::Error::ChildrenExist</code> if a target still exists.</li>
</ul>

<p>When performing the dependent destroy logic, the targets criteria is run <code>unscoped</code> (without the any declared <code>default_scope</code>).</p>

<p>The following describes the behavior of <code>has_many</code> associations:</p>

<ul>
<li>
<p>The <code>has_many</code> association is read only. NoBrainer makes no attempts whatsoever in collecting targets as they get created with <code>Target.create()</code>. This also mean that you cannot use <code>post.comments.build</code>. Rather, you should use <code>Comment.create(:post =&gt; post)</code> and have a presence validation on post.</p>
</li>

<li>
<p>Loading targets through <code>instance.targets</code> will automatically set their matching <code>belongs_to</code> associations to <code>instance</code>, with or without eager loading.</p>
</li>

<li>
<p><code>instance.targets</code> returns the criteria <code>Target.where(foreign_key =&gt; owner.primary_key)</code>, which is cached. This means that you will always get the same instance of criteria on a given instance, which will cache enumerated documents. When a custom <code>:scope</code> is defined, the custom scope is evaluated in the context of <code>Target</code> and added to the criteria. Note that using <code>unscoped</code> has no effect on the custom scope.</p>
</li>
</ul>

<p><code>has_many</code> associations leverage the cache, illustrated with the following example. You can read more about the caching behavior in the <a href="/docs/caching">caching section</a>.</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Post</span>
  <span class='kp'>include</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Document</span>
  <span class='n'>has_many</span> <span class='ss'>:comments</span>
<span class='k'>end</span>

<span class='k'>class</span> <span class='nc'>Comment</span>
  <span class='kp'>include</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Document</span>
  <span class='n'>belongs_to</span> <span class='ss'>:post</span>
<span class='k'>end</span>

<span class='n'>post</span> <span class='o'>=</span> <span class='no'>Post</span><span class='o'>.</span><span class='n'>create</span>
<span class='n'>post</span><span class='o'>.</span><span class='n'>comments</span><span class='o'>.</span><span class='n'>to_a</span> <span class='c1'># returns []</span>
<span class='no'>Comment</span><span class='o'>.</span><span class='n'>create</span><span class='p'>(</span><span class='ss'>:post</span> <span class='o'>=&gt;</span> <span class='n'>post</span><span class='p'>)</span>
<span class='n'>post</span><span class='o'>.</span><span class='n'>comments</span><span class='o'>.</span><span class='n'>to_a</span> <span class='c1'># still returns [], because the enumerator has already</span>
                   <span class='c1'># been invoked, and thus the comments are cached.</span>
<span class='n'>post</span><span class='o'>.</span><span class='n'>comments</span><span class='o'>.</span><span class='n'>reload</span>
<span class='n'>post</span><span class='o'>.</span><span class='n'>comments</span><span class='o'>.</span><span class='n'>to_a</span> <span class='c1'># contains a comment.</span>
</code></pre></div>
<h2 id="has_many_through_association">has_many through Association</h2>

<p>The <code>has_many</code> syntax is the following: <code>has_many :targets, :through =&gt; :association</code>. <code>targets</code> must be a defined association on the through <code>association</code>. You may go through any associations. No other options are supported.</p>

<p>The implementation of <code>has_many</code> through is essentially a thin wrapper around the eager loading functionality, which implies that reading a <code>has_many</code> through association will not yield a criteria, but a plain unmodifiable array which gets cached.</p>

<p>The following show an example of using a <code>has_many</code> through association:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Author</span>
  <span class='kp'>include</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Document</span>
  <span class='n'>has_many</span> <span class='ss'>:posts</span>
  <span class='n'>has_many</span> <span class='ss'>:comments</span><span class='p'>,</span> <span class='ss'>:through</span> <span class='o'>=&gt;</span> <span class='ss'>:posts</span>
<span class='k'>end</span>

<span class='k'>class</span> <span class='nc'>Post</span>
  <span class='kp'>include</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Document</span>
  <span class='n'>belongs_to</span> <span class='ss'>:author</span>
  <span class='n'>has_many</span> <span class='ss'>:comments</span>
<span class='k'>end</span>

<span class='k'>class</span> <span class='nc'>Comment</span>
  <span class='kp'>include</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Document</span>
  <span class='n'>belongs_to</span> <span class='ss'>:post</span>
<span class='k'>end</span>

<span class='n'>author</span> <span class='o'>=</span> <span class='no'>Author</span><span class='o'>.</span><span class='n'>create</span>
<span class='n'>post</span> <span class='o'>=</span> <span class='no'>Post</span><span class='o'>.</span><span class='n'>create</span><span class='p'>(</span><span class='ss'>:author</span> <span class='o'>=&gt;</span> <span class='n'>author</span><span class='p'>)</span>
<span class='mi'>2</span><span class='o'>.</span><span class='n'>times</span> <span class='p'>{</span> <span class='no'>Comment</span><span class='o'>.</span><span class='n'>create</span><span class='p'>(</span><span class='ss'>:post</span> <span class='o'>=&gt;</span> <span class='n'>post</span><span class='p'>)</span> <span class='p'>}</span>
<span class='n'>author</span><span class='o'>.</span><span class='n'>comments</span> <span class='c1'># returns the two comments</span>
</code></pre></div>
<h2 id="has_and_belongs_to_many_association">has_and_belongs_to_many Association</h2>

<p>NoBrainer will never support such association. Nevertheless, you may create your own join table as such:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Patient</span>
  <span class='kp'>include</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Document</span>
  <span class='n'>has_many</span> <span class='ss'>:appointments</span>
  <span class='n'>has_many</span> <span class='ss'>:physicians</span><span class='p'>,</span> <span class='ss'>:through</span> <span class='o'>=&gt;</span> <span class='ss'>:appointments</span>
<span class='k'>end</span>

<span class='k'>class</span> <span class='nc'>Appointment</span>
  <span class='kp'>include</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Document</span>
  <span class='n'>belongs_to</span> <span class='ss'>:patient</span>
  <span class='n'>belongs_to</span> <span class='ss'>:physician</span>
<span class='k'>end</span>

<span class='k'>class</span> <span class='nc'>Physician</span>
  <span class='kp'>include</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Document</span>
  <span class='n'>has_many</span> <span class='ss'>:appointments</span>
  <span class='n'>has_many</span> <span class='ss'>:patients</span><span class='p'>,</span> <span class='ss'>:through</span> <span class='o'>=&gt;</span> <span class='ss'>:appointments</span>
<span class='k'>end</span>
</code></pre></div>
<h2 id="has_one_association">has_one Association</h2>

<p>The <code>has_one</code> association is a <code>has_many</code> with the following differences:</p>

<ul>
<li>The target name is assumed to be singular instead of plural.</li>

<li>Reading the target of a <code>has_one</code> association returns a single document, unlike a <code>has_many</code> which returns an array of documents. Nevertheless, NoBrainer will emit warnings if your association has more than one element.</li>
</ul>

<p>Note that the <code>dependent</code> option behaves like the <code>has_many</code> association one. In other words, all the targets matching the foreign key of the owner will be subject to the <code>destroy</code> behavior, not just the first one.</p>

<p>The <code>has_one through</code> association follow the same rules as the <code>has_many through</code> association.</p>

<h2 id="accept_nested_attributes_for">accept_nested_attributes_for</h2>

<p>This will never be implemented since <code>has_many</code> associations are read only. This sort of feature belongs in a separate gem anyway because it’s a crazy feature.</p>

<h2 id="reflection">Reflection</h2>

<p>You can retrieve the association declarations with <code>Model.association_metadata</code>. It returns a hash of the form <code>{target_name =&gt; metadata_instance}</code>. Association instances can be retrieved on a model instance with <code>model_instance.associations[metadata_instance]</code>.</p>

      </article>
    </div>

    <div class="clear"></div>

  </div>
</section>


  <footer>
  <div class="grid">
    <div class="unit whole">
      NoBrainer is written and maintained by
      <a href="https://twitter.com/nviennot">Nicolas Viennot</a>.
    </div>
  </div>
</footer>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46753546-1', 'nobrainer.io');
  ga('send', 'pageview');
</script>

</body>
</html>
