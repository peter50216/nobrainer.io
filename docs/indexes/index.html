<!doctype html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Indexes Â· NoBrainer</title>
  <link rel="stylesheet" href="/css/screen.css" />
</head>

<body class="wrap">
  <header>
  <div class="grid">
    <div class="unit one-fifth"> </div>
    <div class="unit four-fifths">
      <h1> <a href="/"> <span>NoBrainer</span> </a> </h1>
      <h3>A Ruby ORM for RethinkDB</h3>
    </div>
  </div>

<!-- put back when we do it properly for mobiles -->
<!-- <a href="https://github.com/nviennot/nobrainer"><img style="position: absolute; top: 0; right:0; border: 0; width: 149px; height: 149px;" src="/img/forkme.png" alt="Fork me on GitHub"></a> -->

</header>


  <section class="docs">
  <div class="grid">

    <div class="unit one-fifth">
  <aside>
    <h4>Getting Started</h4> 

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/introduction/">Introduction</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/installation/">Installation</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/differences_from_other_orms/">Differences from other ORMs</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Models</h4>          

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/models/">Models</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/fields/">Fields</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/types/">Types</a></li>
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/timestamps/">Timestamps</a></li>
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/serialization/">Serialization</a></li>
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/persistence/">Persistence</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/callbacks/">Callbacks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/validations/">Validations</a></li>
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/dirty_tracking/">Dirty Tracking</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
      <li class=""><a href="/docs/associations/">Associations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Querying</h4>        

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/querying/">Querying</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/scopes/">Scopes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/joins/">Joins</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/eager_loading/">Eager Loading</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Advanced Topics</h4> 

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/rql_layer/">RQL Layer</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class="current"><a href="/docs/indexes/">Indexes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/atomic_ops/">Atomic Operations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/distributed_locks/">Distributed Locks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/db_management/">DB Management</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/table_configuration/">Table Configuration</a></li>
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/multi_tenancy/">Multi Tenancy</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/caching/">Caching</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/event_machine/">Event Machine</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Recipes</h4>         

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/real_time_tutorial/">Real Time Tutorial</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Miscellaneous</h4>   

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/roadmap/">Roadmap</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/changelog/">Changelog</a></li>
    
  


  

  
    
  

  
    
  
    
      <li class=""><a href="/docs/3rd_party_integration/">3rd-party Integration</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/communication/">Communication</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/faq/">FAQ</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/credits/">Credits</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

  </aside>
</div>


    <div class="like-buttons">
      <div class="github">
        <iframe src="/github-btn.html?user=nviennot&repo=nobrainer&type=watch&count=true"
          allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>
      </div>

      <div class="twitter">
        <a href="https://twitter.com/nviennot" class="twitter-follow-button" data-show-count="false" data-lang="en">Follow @nviennot</a>
       <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      </div>

    </div>

    <div class="unit four-fifths">
      <article>
        <h1>Indexes</h1>
        
<p>RethinkDB supports four kinds of secondary indexes:</p>

<ol>
<li>Simple indexes based on the value of a single field.</li>

<li>Compound indexes based on multiple fields.</li>

<li>Multi indexes based on arrays of values.</li>

<li>Indexes based on arbitrary expressions.</li>
</ol>

<p>NoBrainer provides methods to declare indexes which can then be leveraged when generating queries as RethinkDB does not use indexes automatically.</p>

<h2 id="declaring_indexes">Declaring Indexes</h2>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Post</span>
  <span class='kp'>include</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Document</span>

  <span class='c1'># Indexes can be declared on belongs_to and fields declarations</span>
  <span class='n'>belongs_to</span> <span class='ss'>:author</span><span class='p'>,</span> <span class='ss'>:index</span> <span class='o'>=&gt;</span> <span class='kp'>true</span>  <span class='c1'># Simple index</span>
  <span class='n'>field</span> <span class='ss'>:tags</span><span class='p'>,</span> <span class='ss'>:index</span> <span class='o'>=&gt;</span> <span class='ss'>:multi</span> <span class='c1'># Multi index</span>
<span class='k'>end</span>

<span class='k'>class</span> <span class='nc'>Author</span>
  <span class='kp'>include</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Document</span>

  <span class='n'>field</span> <span class='ss'>:tags</span>
  <span class='n'>field</span> <span class='ss'>:first_name</span>
  <span class='n'>field</span> <span class='ss'>:last_name</span>
  <span class='n'>has_many</span> <span class='ss'>:posts</span>

  <span class='c1'># Indexes can also be declared with the index keyword as such:</span>

  <span class='c1'># Simple index</span>
  <span class='n'>index</span> <span class='ss'>:first_name</span>
  <span class='n'>index</span> <span class='ss'>:created_at</span>

  <span class='c1'># Multi index</span>
  <span class='n'>index</span> <span class='ss'>:tags</span><span class='p'>,</span> <span class='ss'>:multi</span> <span class='o'>=&gt;</span> <span class='kp'>true</span>

  <span class='c1'># Compound index with implicit name</span>
  <span class='n'>index</span> <span class='o'>[</span><span class='ss'>:first_name</span><span class='p'>,</span> <span class='ss'>:last_name</span><span class='o'>]</span>

  <span class='c1'># Compound index with explicit name</span>
  <span class='n'>index</span> <span class='ss'>:full_name_compound</span><span class='p'>,</span> <span class='o'>[</span><span class='ss'>:first_name</span><span class='p'>,</span> <span class='ss'>:last_name</span><span class='o'>]</span>

  <span class='c1'># Arbitrary index</span>
  <span class='n'>index</span> <span class='ss'>:full_name_lambda</span><span class='p'>,</span> <span class='o'>-&gt;</span><span class='p'>(</span><span class='n'>doc</span><span class='p'>){</span> <span class='n'>doc</span><span class='o'>[</span><span class='s1'>&#39;field1&#39;</span><span class='o'>]</span> <span class='o'>+</span> <span class='s2'>&quot;_&quot;</span> <span class='o'>+</span> <span class='n'>doc</span><span class='o'>[</span><span class='s1'>&#39;field2&#39;</span><span class='o'>]</span> <span class='p'>}</span>

  <span class='c1'># Arbitrary index, multi</span>
  <span class='n'>index</span> <span class='ss'>:field12</span><span class='p'>,</span> <span class='o'>-&gt;</span><span class='p'>(</span><span class='n'>doc</span><span class='p'>){</span> <span class='o'>[</span><span class='n'>doc</span><span class='o'>[</span><span class='s1'>&#39;field1&#39;</span><span class='o'>]</span><span class='p'>,</span> <span class='n'>doc</span><span class='o'>[</span><span class='s1'>&#39;field2&#39;</span><span class='o'>]]</span> <span class='p'>},</span> <span class='ss'>:multi</span> <span class='o'>=&gt;</span> <span class='kp'>true</span>
<span class='k'>end</span>
</code></pre></div>
<h2 id="using_indexes">Using Indexes</h2>

<p>Because RethinkDB requires explicit index usage, NoBrainer tries to leverage indexes to compile efficient queries implicitly. For example:</p>
<div class='highlight'><pre><code class='ruby'><span class='c1'># Implicit use of indexes</span>

<span class='c1'># Use the index declared on the belongs_to association</span>
<span class='n'>author</span><span class='o'>.</span><span class='n'>posts</span><span class='o'>.</span><span class='n'>each</span> <span class='p'>{</span> <span class='p'>}</span>

<span class='c1'># Also use the author_id index with a get_all query</span>
<span class='no'>Author</span><span class='o'>.</span><span class='n'>eager_load</span><span class='p'>(</span><span class='ss'>:posts</span><span class='p'>)</span><span class='o'>.</span><span class='n'>first</span>

<span class='c1'># Also use the author_id index with a get_all query</span>
<span class='no'>Post</span><span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:author_id</span><span class='o'>.</span><span class='n'>in</span> <span class='o'>=&gt;</span> <span class='o'>[</span><span class='mi'>1</span><span class='p'>,</span><span class='mi'>2</span><span class='p'>,</span><span class='mi'>3</span><span class='o'>]</span><span class='p'>)</span><span class='o'>.</span><span class='n'>each</span> <span class='p'>{</span> <span class='p'>}</span>

<span class='c1'># Uses the created_at index with a between query</span>
<span class='no'>Author</span><span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:created_at</span><span class='o'>.</span><span class='n'>gt</span> <span class='o'>=&gt;</span> <span class='mi'>1</span><span class='o'>.</span><span class='n'>year</span><span class='o'>.</span><span class='n'>ago</span><span class='p'>)</span>

<span class='c1'># Use a multi index</span>
<span class='no'>Author</span><span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:tags</span><span class='o'>.</span><span class='n'>any</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;programmer&#39;</span><span class='p'>)</span>

<span class='c1'># Use the full_name_compound index</span>
<span class='no'>Author</span><span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:first_name</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;John&#39;</span><span class='p'>,</span> <span class='ss'>:last_name</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;Saucisse&#39;</span><span class='p'>)</span>

<span class='c1'># Explicit use of indexes</span>

<span class='c1'># Use the simple index first_name</span>
<span class='no'>Author</span><span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:first_name</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;John&#39;</span><span class='p'>)</span>

<span class='c1'># Explicit use of the compound index full_name_compound</span>
<span class='no'>Author</span><span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:full_name_compound</span> <span class='o'>=&gt;</span> <span class='o'>[</span><span class='s1'>&#39;John&#39;</span><span class='p'>,</span> <span class='s1'>&#39;Saucisse&#39;</span><span class='o'>]</span><span class='p'>)</span>

<span class='c1'># Explicit use of the lambda index full_name_lambda</span>
<span class='no'>Author</span><span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:full_name_lambda</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;John_Saucisse&#39;</span><span class='p'>)</span>
</code></pre></div>
<p>Because of the implicit/explicit usage of indexes, NoBrainer does not allow a compound or arbitrary index to have the same name as a regular field. Otherwise, the query would be ambiguous: would we be filtering on the field or the index?</p>

<p><code>criteria.order_by()</code> will also try to use an index for efficiency. NoBrainer will try to use an index only on the first ordering clause.</p>

<p>When compiling a query, NoBrainer may have multiple possibilities to pick which index to use. When not sure, NoBrainer will pick the first declared index in the model. You may manually sepecify which index to use by criteria with <code>with_index(index_name)</code>. This forces NoBrainer to use the given index when compiling the query. An error <code>NoBrainer::Error::CannotUseIndex</code> will be raised if the provided index cannot be used. You may also chain <code>without_index</code> to disable the usage of indexes all together.</p>

<p>You may also use <code>with_index()</code> without arguments. In this case, an exception is raised if NoBrainer cannot find an index to use when compiling the query.</p>

<p>The latest <code>with_index()</code> in the query wins.</p>

<h2 id="testing_indexes">Testing Indexes</h2>

<p>To test your code and do some profiling, you may use <code>criteria.used_index</code> to get the name of the index that will be used for the query. You may also use <code>criteria.where_indexed?</code> or <code>criteria.order_by_indexed?</code> to test if an index is used. Note that these methods applies the default scope before returning an answer.</p>

<h2 id="creating_indexes">Creating Indexes</h2>

<p>Once declared, indexes need to be created before being usable.</p>

<p>When using Rails, you may use the rake task:</p>
<div class='highlight'><pre><code class='bash'><span class='nv'>$ </span>rake nobrainer:sync_schema
</code></pre></div>
<p>You can also update indexes programmatically:</p>
<div class='highlight'><pre><code class='ruby'><span class='no'>NoBrainer</span><span class='o'>.</span><span class='n'>sync_schema</span> <span class='c1'># Synchronize table schema</span>
</code></pre></div>
<p>NoBrainer maintains a list of index metadata in a table named <code>nobrainer_index_meta</code>. This way, NoBrainer can keep track of the indexes state on the database, and update indexes which definition have changed.</p>

<p>NoBrainer waits for the index creation by default. You may pass <code>:wait =&gt; false</code> to <code>sync_schema</code> to skip the wait.</p>

<h2 id="aliases">Aliases</h2>

<p>An alias can be specified on a given index as such:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>index</span> <span class='ss'>:email</span><span class='p'>,</span> <span class='ss'>:store_as</span> <span class='o'>=&gt;</span> <span class='ss'>:e</span>
</code></pre></div>
<p>NoBrainer will translate all the references to that index when compiling queries and reading models back from the database.</p>

<p>The only place you need to be careful is when using RQL, including passing RQL lambda. NoBrainer does not translate aliases with user provided RQL code.</p>

<h2 id="external_indexes">External Indexes</h2>

<p>If you prefer to manage certain indexes yourself, you may declare them as external as such:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>index</span> <span class='ss'>:email</span><span class='p'>,</span> <span class='ss'>:external</span> <span class='o'>=&gt;</span> <span class='kp'>true</span>
</code></pre></div>
<p>NoBrainer does not touch external indexes when synchronizing indexes.</p>

<h2 id="reflection">Reflection</h2>

<p>You may go through the list of declared indexes on a model by looking up the hash <code>Model.indexes</code> of the form <code>{:index_name =&gt; index}</code>. <code>index.kind</code> is the kind of index which can be <code>:single</code>, <code>:compound</code>, or <code>:proc</code>. <code>index.what</code> is the indexed value which is the field name, field names, or proc depending if the index kind is a single, compound, or proc, respectively. <code>index.multi</code> is a boolean indicating whether the index is a multi index. <code>index.geo</code> is a boolean indicating whether the index is a geo index.</p>

      </article>
    </div>

    <div class="clear"></div>

  </div>
</section>


  <footer>
  <div class="grid">
    <div class="unit whole">
      NoBrainer is written and maintained by
      <a href="https://twitter.com/nviennot">Nicolas Viennot</a>.
    </div>
  </div>
</footer>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46753546-1', 'nobrainer.io');
  ga('send', 'pageview');
</script>

</body>
</html>
