<!doctype html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Types · NoBrainer</title>
  <link rel="stylesheet" href="/css/screen.css" />
</head>

<body class="wrap">
  <header>
  <div class="grid">
    <div class="unit one-fifth"> </div>
    <div class="unit four-fifths">
      <h1> <a href="/"> <span>NoBrainer</span> </a> </h1>
      <h3>A Ruby ORM for RethinkDB</h3>
    </div>
  </div>

<!-- put back when we do it properly for mobiles -->
<!-- <a href="https://github.com/nviennot/nobrainer"><img style="position: absolute; top: 0; right:0; border: 0; width: 149px; height: 149px;" src="/img/forkme.png" alt="Fork me on GitHub"></a> -->

</header>


  <section class="docs">
  <div class="grid">

    <div class="unit one-fifth">
  <aside>
    <h4>Getting Started</h4> 

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/introduction/">Introduction</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/installation/">Installation</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/differences_from_other_orms/">Differences from other ORMs</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Models</h4>          

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/models/">Models</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/fields/">Fields</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class="current"><a href="/docs/types/">Types</a></li>
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/timestamps/">Timestamps</a></li>
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/serialization/">Serialization</a></li>
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/persistence/">Persistence</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/callbacks/">Callbacks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/validations/">Validations</a></li>
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/dirty_tracking/">Dirty Tracking</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
      <li class=""><a href="/docs/associations/">Associations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Querying</h4>        

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/querying/">Querying</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/scopes/">Scopes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/joins/">Joins</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/eager_loading/">Eager Loading</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Advanced Topics</h4> 

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/rql_layer/">RQL Layer</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/indexes/">Indexes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/atomic_ops/">Atomic Operations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/distributed_locks/">Distributed Locks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/db_management/">DB Management</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/table_configuration/">Table Configuration</a></li>
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/multi_tenancy/">Multi Tenancy</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/caching/">Caching</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/event_machine/">Event Machine</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Recipes</h4>         

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/real_time_tutorial/">Real Time Tutorial</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Miscellaneous</h4>   

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/roadmap/">Roadmap</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/changelog/">Changelog</a></li>
    
  


  

  
    
  

  
    
  
    
      <li class=""><a href="/docs/3rd_party_integration/">3rd-party Integration</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/communication/">Communication</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/faq/">FAQ</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/credits/">Credits</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

  </aside>
</div>


    <div class="like-buttons">
      <div class="github">
        <iframe src="/github-btn.html?user=nviennot&repo=nobrainer&type=watch&count=true"
          allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>
      </div>

      <div class="twitter">
        <a href="https://twitter.com/nviennot" class="twitter-follow-button" data-show-count="false" data-lang="en">Follow @nviennot</a>
       <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      </div>

    </div>

    <div class="unit four-fifths">
      <article>
        <h1>Types</h1>
        
<p>NoBrainer uses a field type mechanism to automatically cast and validates field values. Using the type mechanism improves the integrity and security of your application.</p>

<h2 id="specifying_field_types">Specifying Field Types</h2>

<p>The following example demonstrates how to specify field types:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>User</span>
  <span class='n'>field</span> <span class='ss'>:name</span><span class='p'>,</span>         <span class='ss'>:type</span> <span class='o'>=&gt;</span> <span class='nb'>String</span>
  <span class='n'>field</span> <span class='ss'>:biography</span><span class='p'>,</span>    <span class='ss'>:type</span> <span class='o'>=&gt;</span> <span class='no'>Text</span>
  <span class='n'>field</span> <span class='ss'>:verified</span><span class='p'>,</span>     <span class='ss'>:type</span> <span class='o'>=&gt;</span> <span class='no'>Boolean</span>
  <span class='n'>field</span> <span class='ss'>:num_friends</span><span class='p'>,</span>  <span class='ss'>:type</span> <span class='o'>=&gt;</span> <span class='nb'>Integer</span>
  <span class='n'>field</span> <span class='ss'>:last_seen_at</span><span class='p'>,</span> <span class='ss'>:type</span> <span class='o'>=&gt;</span> <span class='no'>Time</span>
<span class='k'>end</span>
</code></pre></div>
<p>The following types are currently supported:</p>

<ul>
<li><code>String</code></li>

<li><code>Text</code></li>

<li><code>Integer</code></li>

<li><code>Float</code></li>

<li><code>Boolean</code></li>

<li><code>Symbols</code></li>

<li><code>Time</code></li>

<li><code>Date</code></li>

<li><code>Binary</code></li>

<li><code>Array</code></li>

<li><code>Set</code></li>

<li><code>Hash</code></li>

<li><code>Geo::Point</code></li>

<li><code>Geo::Circle</code></li>

<li><code>Geo::Polygon</code></li>

<li><code>Geo::LineString</code></li>
</ul>

<h2 id="model_behavior">Model Behavior</h2>

<p>The behavior is the following:</p>

<ul>
<li>The default field type is <code>Object</code>, meaning that anything will do and values will be delivered to the database as is.</li>

<li>Declaring a <code>Boolean</code> field adds an <code>attr?</code> getter for convenience.</li>

<li>When assigning an attribute to a value, NoBrainer will attempt to cast the given value to the correct type in a safe manner if the value does not match the specified type as described below. If the casting operation fails, then NoBrainer leaves the value as is, meaning that reading the attribute back will return the uncasted value. This should be taken in consideration when writing <code>before_save</code> callbacks since incorrectly typed values may be read.</li>

<li>When performing validations, NoBrainer will check that attribute values match the specified type. If some values do not match their types, validation errors will be added to prevent the model to be persisted.</li>

<li><code>belongs_to</code> foreign key associations are not type checked.</li>

<li>When data is read back from the database, no type casting is performed. For example, when reading back a field from the database with a value of <code>&quot;1&quot;</code> (a string), the field value read from the model API will always be <code>&quot;1&quot;</code> and not <code>1</code>, even if the field type is declared to be an <code>Integer</code>. You must perform a database migration to convert all the strings into integers.</li>
</ul>

<p>Note that the <code>nil</code> value is always valid and never casted. If you wish to prevent this, you may add a <code>not_null</code> or <code>presence</code> validation.</p>

<h2 id="query_behavior">Query Behavior</h2>

<p>NoBrainer validates and cast values passed in <code>where()</code> queries. When a bad value is used, a <code>NoBrainer::Error::InvalidType</code> exception will be raised. If left uncaught in a Rails controller, a 400 status code will be returned. For example:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>User</span>
  <span class='kp'>include</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Document</span>
  <span class='n'>field</span> <span class='ss'>:num_friends</span><span class='p'>,</span> <span class='ss'>:type</span> <span class='o'>=&gt;</span> <span class='nb'>Integer</span>
<span class='k'>end</span>

<span class='no'>User</span><span class='o'>.</span><span class='n'>create</span><span class='p'>(</span><span class='ss'>:num_friends</span> <span class='o'>=&gt;</span> <span class='mi'>30</span><span class='p'>)</span>
<span class='no'>User</span><span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:num_friends</span><span class='o'>.</span><span class='n'>gt</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;10&quot;</span><span class='p'>)</span><span class='o'>.</span><span class='n'>first</span> <span class='c1'># returns the user</span>
<span class='no'>User</span><span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:num_friends</span><span class='o'>.</span><span class='n'>gt</span> <span class='o'>=&gt;</span> <span class='s2'>&quot;10xx&quot;</span><span class='p'>)</span><span class='o'>.</span><span class='n'>first</span> <span class='c1'># raises an InvalidType error</span>
</code></pre></div>
<h2 id="types">Types</h2>

<h3 id="string">String</h3>

<ul>
<li>Strings with less than 255 characters are accepted. This length limit is configurable with <code>config.max_string_length</code>.</li>

<li>Symbols are accepted.</li>
</ul>

<h3 id="text">Text</h3>

<ul>
<li>Strings are accepted.</li>
</ul>

<h3 id="integer">Integer</h3>

<ul>
<li>Integers are accepted.</li>

<li>Strings are converted to integers only when the resulting integer can be converted back to the original stripped string. For example, <code>&quot; -4  &quot;</code> and <code>&quot;+3&quot;</code> are valid, but <code>&quot;4f&quot;</code> or <code>&quot;&quot;</code> are not.</li>

<li>Floats are accepted when their values matches exactly an integer.</li>
</ul>

<h3 id="float">Float</h3>

<ul>
<li>Floats are accepted.</li>

<li>Integers are accepted.</li>

<li>Strings are converted to floats only when the resulting integer can be converted back to the original stripped string, excluding leading <code>0</code>’s. Be aware that the current mechanism assume that the decimal separator is <code>&quot;.&quot;&#39;</code>. No localization is performed, meaning that using <code>&quot;,&quot;</code> as a decimal separator will not work.</li>
</ul>

<h3 id="boolean">Boolean</h3>

<ul>
<li><code>true</code> and <code>false</code> are accepted.</li>

<li>Strings are accepted with the following rules: the lowercase stripped value must either be <code>true</code>, <code>yes</code>, <code>t</code>, <code>1</code> or <code>false</code>, <code>no</code>, <code>f</code>, <code>0</code>.</li>

<li><code>1</code> and <code>0</code> integers are accepted.</li>
</ul>

<h3 id="symbols">Symbols</h3>

<ul>
<li>Symbols are accepted.</li>

<li>Non empty strings are accepted. The cast operation is <code>value.strip.to_sym</code>.</li>
</ul>

<h3 id="time">Time</h3>

<ul>
<li>Times are accepted.</li>

<li>Dates are not accepted.</li>

<li>Strings in the ISO 8601 combined date and time format are accepted. For example <code>&quot;2007-04-05T14:30Z&quot;</code> or <code>&quot;2007-04-05T12:30-02:00&quot;</code>.</li>
</ul>

<p>Note that NoBrainer can be configured with <code>user_timezone</code> and <code>db_timezone</code> to specify how timezones should be handled. Read more in the <a href="/docs/installation">Installation</a> section to learn more.</p>

<p>Read more about <code>Time</code> at the bottom of this page.</p>

<h3 id="date">Date</h3>

<ul>
<li>Dates are accepted.</li>

<li>Times are not accepted.</li>

<li>Strings in the ISO 8601 date format are accepted. For example <code>&quot;2007-04-05&quot;</code>.</li>

<li>Any other value is ignored, and a validation error is added.</li>
</ul>

<p>Note that Dates are persisted in the database as UTC times. This is an important consideration when querying dates due to time millisecond precision.</p>

<p>Read more about <code>Date</code> at the bottom of this page.</p>

<h3 id="binary">Binary</h3>

<ul>
<li>Binaries are accepted.</li>

<li>Strings are accepted.</li>
</ul>

<h3 id="array">Array</h3>

<ul>
<li>Arrays containing any types are accepted.</li>
</ul>

<h3 id="set">Set</h3>

<ul>
<li>Sets and Arrays containing any types are accepted.</li>
</ul>

<h3 id="hash">Hash</h3>

<ul>
<li>Hashes containing any types are accepted.</li>
</ul>

<h3 id="geopoint">Geo::Point</h3>

<ul>
<li>Geo::Point are accepted.</li>

<li>Pairs of floats: <code>[longitude, latitude]</code>.</li>

<li>Hashes <code>{:longitude =&gt; long, :latitude =&gt; lat}</code> or <code>{:long =&gt; long, :lat =&gt; lat}</code>.</li>
</ul>

<h3 id="geocircle">Geo::Circle</h3>

<ul>
<li>Geo::Circle are accepted.</li>

<li>Pairs of <code>[center, radius]</code> where <code>center</code> can coerce to a <code>Geo::Point</code> and <code>radius</code> to a Float.</li>

<li>Hash <code>{:center =&gt; center, :radius =&gt; radius}</code>.</li>
</ul>

<p>Additionally, you may pass options as specified in the <a href="http://www.rethinkdb.com/api/ruby/circle/"><code>r.circle</code></a> documentation.</p>

<h3 id="geopolygon">Geo::Polygon</h3>

<ul>
<li>Geo::Polygon are accepted</li>

<li>Accepts an array of values coercible to a <code>Geo::Point</code>.</li>
</ul>

<h3 id="geolinestring">Geo::LineString</h3>

<ul>
<li>Geo::LineString are accepted</li>

<li>Accepts an array of values coercible to a <code>Geo::Point</code>.</li>
</ul>

<h3 id="datetime">DateTime</h3>

<ul>
<li>Use the <code>Time</code> type instead. Read more below.</li>
</ul>

<h2 id="custom_types">Custom Types</h2>

<p>NoBrainer supports custom types. The following shows an example to define a <code>Point</code> type.</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Point</span> <span class='o'>&lt;</span> <span class='no'>Struct</span><span class='o'>.</span><span class='n'>new</span><span class='p'>(</span><span class='ss'>:x</span><span class='p'>,</span> <span class='ss'>:y</span><span class='p'>)</span>
  <span class='c1'># This class method imports a user facing values into the model.</span>
  <span class='c1'># For example, calling an attribute setter will call this method.</span>
  <span class='c1'># If the given value cannot be casted safely, a</span>
  <span class='c1'># NoBrainer::Error::InvalidType error must be raised.</span>
  <span class='c1'># Otherwise, the method returns the converted value.</span>
  <span class='k'>def</span> <span class='nc'>self</span><span class='o'>.</span><span class='nf'>nobrainer_cast_user_to_model</span><span class='p'>(</span><span class='n'>value</span><span class='p'>)</span>
    <span class='k'>case</span> <span class='n'>value</span>
    <span class='k'>when</span> <span class='no'>Point</span> <span class='k'>then</span> <span class='n'>value</span>
    <span class='k'>when</span> <span class='no'>Hash</span>  <span class='k'>then</span> <span class='kp'>new</span><span class='p'>(</span><span class='n'>value</span><span class='o'>[</span><span class='ss'>:x</span><span class='o'>]</span> <span class='o'>||</span> <span class='n'>value</span><span class='o'>[</span><span class='s1'>&#39;x&#39;</span><span class='o'>]</span><span class='p'>,</span> <span class='n'>value</span><span class='o'>[</span><span class='ss'>:y</span><span class='o'>]</span> <span class='o'>||</span> <span class='n'>value</span><span class='o'>[</span><span class='s1'>&#39;y&#39;</span><span class='o'>]</span><span class='p'>)</span>
    <span class='k'>else</span> <span class='k'>raise</span> <span class='no'>NoBrainer</span><span class='o'>::</span><span class='no'>Error</span><span class='o'>::</span><span class='no'>InvalidType</span>
    <span class='k'>end</span>
  <span class='k'>end</span>

  <span class='c1'># This class method translates the given value to a compatible</span>
  <span class='c1'># RethinkDB type value.</span>
  <span class='c1'># It is used when writing to the database, for example saving a model.</span>
  <span class='k'>def</span> <span class='nc'>self</span><span class='o'>.</span><span class='nf'>nobrainer_cast_model_to_db</span><span class='p'>(</span><span class='n'>value</span><span class='p'>)</span>
    <span class='p'>{</span><span class='s1'>&#39;x&#39;</span> <span class='o'>=&gt;</span> <span class='n'>value</span><span class='o'>.</span><span class='n'>x</span><span class='p'>,</span> <span class='s1'>&#39;y&#39;</span> <span class='o'>=&gt;</span> <span class='n'>value</span><span class='o'>.</span><span class='n'>y</span><span class='p'>}</span>
  <span class='k'>end</span>

  <span class='c1'># This class method translates a value from the database to the proper type.</span>
  <span class='c1'># It is used when reading from the database.</span>
  <span class='k'>def</span> <span class='nc'>self</span><span class='o'>.</span><span class='nf'>nobrainer_cast_db_to_model</span><span class='p'>(</span><span class='n'>value</span><span class='p'>)</span>
    <span class='no'>Point</span><span class='o'>.</span><span class='n'>new</span><span class='p'>(</span><span class='n'>value</span><span class='o'>[</span><span class='s1'>&#39;x&#39;</span><span class='o'>]</span><span class='p'>,</span> <span class='n'>value</span><span class='o'>[</span><span class='s1'>&#39;y&#39;</span><span class='o'>]</span><span class='p'>)</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre></div>
<h2 id="overriding_default_behavior">Overriding Default Behavior</h2>

<p>If you wish to override some of the default behavior of an existing type, for example, to cast integers in an unsafe manner, you may use override the attribute setter. For example:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>User</span>
  <span class='n'>field</span> <span class='ss'>:num_friends</span><span class='p'>,</span> <span class='ss'>:type</span> <span class='o'>=&gt;</span> <span class='nb'>Integer</span>

  <span class='k'>def</span> <span class='nf'>num_friends</span><span class='o'>=</span><span class='p'>(</span><span class='n'>value</span><span class='p'>)</span>
    <span class='k'>super</span><span class='p'>(</span><span class='n'>value</span><span class='o'>.</span><span class='n'>to_i</span><span class='p'>)</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre></div>
<p>Another way to override a type behavior is to define custom casting behavior similarly to custom types. For example, to parse all times with <a href="https://github.com/mojombo/chronic">chronic</a>, the following code will do:</p>
<div class='highlight'><pre><code class='ruby'><span class='k'>class</span> <span class='nc'>Time</span>
  <span class='k'>def</span> <span class='nc'>self</span><span class='o'>.</span><span class='nf'>nobrainer_cast_user_to_model</span><span class='p'>(</span><span class='n'>value</span><span class='p'>)</span>
    <span class='n'>value</span> <span class='o'>=</span> <span class='no'>Chronic</span><span class='o'>.</span><span class='n'>parse</span><span class='p'>(</span><span class='n'>value</span><span class='p'>)</span> <span class='k'>rescue</span> <span class='n'>value</span> <span class='k'>if</span> <span class='n'>value</span><span class='o'>.</span><span class='n'>is_a?</span><span class='p'>(</span><span class='nb'>String</span><span class='p'>)</span>
    <span class='k'>super</span><span class='p'>(</span><span class='n'>value</span><span class='p'>)</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</code></pre></div>
<p>Note that calling <code>super()</code> is important as it will take care of the timezone converstion if needed.</p>

<p>You can also subclass the <code>Time</code> class, add the casting method, and call it <code>ChronicTime</code>. The chronic time casting will only be performed if you use the <code>ChronicTime</code> type instead of the <code>Time</code> type.</p>

<h2 id="datetime_notes">Date/Time Notes</h2>

<p>Regarding date/time types, here is what you need to know:</p>

<ul>
<li>The RethinkDB driver only supports <code>Time</code> serialization/deserialization at this moment. In Ruby 1.9+, there is no longer the need to use the <code>DateTime</code> type as the <code>Time</code> type no longer has restrictive bounds. Nevertheless, the RethinkDB database have some limitations and are described <a href="http://www.rethinkdb.com/docs/dates-and-times/">in their documentation</a>. Essentially, you can start to worry when you start to deal with times which year is outside of the range <code>[1400, 10000]</code>. See also <a href="https://gist.github.com/coffeemug/6168031">this post</a>.</li>

<li>Times are serialized by the driver by passing to the database a special hash containing <code>time.to_f</code> and its timezone. The database takes this value and truncates it to get a precision of a millisecond.</li>

<li>When writing your application tests, you have to keep this loss of precision in mind when using <code>==</code> on times. Applying <code>to_i</code> before comparing times is a good workaround to millisecond rounding issues.</li>
</ul>
<hr />
<p>If this behavior does not match your expectations, please open an issue on GitHub.</p>

      </article>
    </div>

    <div class="clear"></div>

  </div>
</section>


  <footer>
  <div class="grid">
    <div class="unit whole">
      NoBrainer is written and maintained by
      <a href="https://twitter.com/nviennot">Nicolas Viennot</a>.
    </div>
  </div>
</footer>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46753546-1', 'nobrainer.io');
  ga('send', 'pageview');
</script>

</body>
</html>
