<!doctype html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Querying · NoBrainer</title>
  <link rel="stylesheet" href="/css/screen.css" />
</head>

<body class="wrap">
  <header>
  <div class="grid">
    <div class="unit one-fifth"> </div>
    <div class="unit four-fifths">
      <h1> <a href="/"> <span>NoBrainer</span> </a> </h1>
      <h3>A Ruby ORM for RethinkDB</h3>
    </div>
  </div>

<!-- put back when we do it properly for mobiles -->
<!-- <a href="https://github.com/nviennot/nobrainer"><img style="position: absolute; top: 0; right:0; border: 0; width: 149px; height: 149px;" src="/img/forkme.png" alt="Fork me on GitHub"></a> -->

</header>


  <section class="docs">
  <div class="grid">

    <div class="unit one-fifth">
  <aside>
    <h4>Getting Started</h4> 

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/introduction/">Introduction</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/installation/">Installation</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/differences_from_other_orms/">Differences from other ORMs</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Models</h4>          

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/models/">Models</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/fields/">Fields</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/types/">Types</a></li>
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/timestamps/">Timestamps</a></li>
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/serialization/">Serialization</a></li>
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/persistence/">Persistence</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/callbacks/">Callbacks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/validations/">Validations</a></li>
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/dirty_tracking/">Dirty Tracking</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
      <li class=""><a href="/docs/associations/">Associations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Querying</h4>        

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class="current"><a href="/docs/querying/">Querying</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/scopes/">Scopes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/joins/">Joins</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/eager_loading/">Eager Loading</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Advanced Topics</h4> 

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/rql_layer/">RQL Layer</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/indexes/">Indexes</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/atomic_ops/">Atomic Operations</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/distributed_locks/">Distributed Locks</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/db_management/">DB Management</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/table_configuration/">Table Configuration</a></li>
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/multi_tenancy/">Multi Tenancy</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/caching/">Caching</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/event_machine/">Event Machine</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Recipes</h4>         

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/real_time_tutorial/">Real Time Tutorial</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

    <h4>Miscellaneous</h4>   

<ul>

  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/roadmap/">Roadmap</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/changelog/">Changelog</a></li>
    
  


  

  
    
  

  
    
  
    
      <li class=""><a href="/docs/3rd_party_integration/">3rd-party Integration</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/communication/">Communication</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/faq/">FAQ</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  
    
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/credits/">Credits</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
</ul>

  </aside>
</div>


    <div class="like-buttons">
      <div class="github">
        <iframe src="/github-btn.html?user=nviennot&repo=nobrainer&type=watch&count=true"
          allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>
      </div>

      <div class="twitter">
        <a href="https://twitter.com/nviennot" class="twitter-follow-button" data-show-count="false" data-lang="en">Follow @nviennot</a>
       <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      </div>

    </div>

    <div class="unit four-fifths">
      <article>
        <h1>Querying</h1>
        
<p>NoBrainer supports a rich query language that supports a wide range of features. This section is organized in two parts. The first one describes methods used to construct criteria, and the second one describes the methods that evaluate criteria.</p>

<h2 id="constructing_criteria">Constructing Criteria</h2>

<h3 id="all">all</h3>

<p><code>Model.all</code> yields a criterion that can be chained with other criteria. This is not so useful as most of the chainable criteria and terminators can be directly called on the Model class. For example <code>Model.each { }</code> and <code>Model.all.each { }</code> are equivalent.</p>
<hr />
<h3 id="where">where()</h3>

<p>The <code>where()</code> method selects documents for which its given predicates are true. The rules are the following:</p>

<ul>
<li>
<p><code>where(p)</code> returns the documents that matches the predicates p.</p>
</li>

<li>
<p><code>where(p1).where(p2)</code> is equivalent to <code>where(p1, p2)</code></p>
</li>
</ul>

<p>The predicates are described below:</p>

<ul>
<li><code>[p1,...,pN]</code> evaluates to <code>:and =&gt; [p1,...,pN]</code>.</li>

<li><code>:and =&gt; [p1,...,pN]</code>: evaluates to true when all the predicates are true.</li>

<li><code>:or =&gt; [p1,...,pN]</code>: evaluates to true when at least one of the predicates is true.<br />Be aware that <code>[:a =&gt; 1, :b =&gt; 2]</code> is the same as <code>[{:a =&gt; 1, :b =&gt; 2}]</code>, which is not the same as <code>[{:a =&gt; 1}, {:b =&gt; 2}]</code>. NoBrainer prevents the former usage to avoid programming mistakes. If you knwo what you are doing, you may use <code>:_or</code>.</li>

<li><code>:not =&gt; p</code>: evaluates to true when <code>p</code> is false.</li>

<li><code>:attr =&gt; value</code> evaluates to <code>:attr.eq =&gt; value</code></li>

<li><code>:attr.eq =&gt; /regexp/</code> evaluates to true when <code>attr</code> matches the regular expression.</li>

<li><code>:attr.eq =&gt; (min..max)</code> evaluates to true when <code>attr</code> is between the range.</li>

<li><code>:attr.eq =&gt; value</code> evaluates to true when <code>attr</code> is equal to <code>value</code>.</li>

<li><code>:attr.gt =&gt; value</code> evaluates to true when <code>attr</code> is greater than <code>value</code>.</li>

<li><code>:attr.ge =&gt; value</code> evaluates to true when <code>attr</code> is greater than or equal to <code>value</code>.</li>

<li><code>:attr.gte =&gt; value</code> evaluates to <code>:attr.ge =&gt; value</code></li>

<li><code>:attr.lt =&gt; value</code> evaluates to true when <code>attr</code> is less than <code>value</code>.</li>

<li><code>:attr.le =&gt; value</code> evaluates to true when <code>attr</code> is less than or equal to <code>value</code>.</li>

<li><code>:attr.lte =&gt; value</code> evaluates to <code>:attr.le =&gt; value</code>.</li>

<li><code>:attr.defined =&gt; true</code> evaluates to true when <code>attr</code> is defined.</li>

<li><code>:attr.undefined =&gt; true</code> evaluates to true when <code>attr</code> is undefined.</li>

<li><code>:attr.in =&gt; [value1,...,valueN]</code> evaluates to true when <code>attr</code> is in the specified array.</li>

<li><code>:attr.include =&gt; value</code> evaluates to true when the array <code>attr</code> includes <code>value</code>.</li>

<li><code>:attr.any.op =&gt; value</code> evalues to true when any of the <code>attr</code> values match <code>value</code> with <code>op</code>.</li>

<li><code>:attr.all.op =&gt; value</code> evalues to true when all of the <code>attr</code> values match <code>value</code> with <code>op</code>.</li>

<li><code>:attr.not.op =&gt; value</code> evalues to true when the <code>attr</code> value does not match <code>value</code> with <code>op</code>.</li>

<li><code>lambda { |doc| rql_expression(doc) }</code> evaluates the RQL expression.</li>
</ul>

<p>A couple of notes:</p>

<ul>
<li>
<p><code>:attr.keyword =&gt; value</code> can also be written as <code>:attr.keyword value</code>.</p>
</li>

<li>
<p><code>where()</code> will try to use one of your declared indexes for performance. Learn more about indexes in the <a href="/docs/indexes">Indexes</a> section. For example, when using the <code>in</code> keyword, NoBrainer will use the <a href="http://www.rethinkdb.com/api/ruby/#get_all"><code>get_all()</code></a> command if there is an index declared on <code>attr</code>. Otherwise, NoBrainer will construct a query equivalent to <code>Model.where(:or =&gt; [:attr =&gt; value1,...,:attr =&gt; valueN])</code>. When using comparison operators, NoBrainer leverage the RQL <a href="http://www.rethinkdb.com/api/ruby/#between"><code>between()</code></a> command if an index is available on <code>attr</code>. When using the <code>any</code> keyword, NoBrainer tries to use a <code>multi</code> index if available.</p>
</li>

<li>
<p><code>Model.where(:attr =&gt; value1).where(:attr =&gt; value2)</code> will match no documents if <code>value1 != value2</code>, even when using a <code>default_scope</code>.</p>
</li>

<li>
<p><code>where()</code> can also take a block to specify an additional RQL filter.</p>
</li>

<li>
<p><code>where()</code> also accept belongs_to associations. In which case, the foreign key is used. For example <code>Comment.where(:post =&gt; Post.first)</code> is valid. <code>Post.first.comments</code> is better though.</p>
</li>

<li>
<p>Nested hash queries are supported. For example <code>where(:address =&gt; {:state.in =&gt; %w(NY CA)})</code> matches the <code>state </code>attribute from the <code>address</code> hash.</p>
</li>

<li>
<p><code>where()</code> performs type checking and only operates on defined attributes. To bypass these checks, you may use <code>_where()</code>.</p>
</li>
</ul>

<p>As an example, one can construct such query:</p>
<div class='highlight'><pre><code class='ruby'><span class='no'>Model</span><span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:or</span> <span class='o'>=&gt;</span> <span class='o'>[-&gt;</span><span class='p'>(</span><span class='n'>doc</span><span class='p'>)</span> <span class='p'>{</span> <span class='n'>doc</span><span class='o'>[</span><span class='ss'>:field1</span><span class='o'>]</span> <span class='o'>&lt;</span> <span class='n'>doc</span><span class='o'>[</span><span class='ss'>:field2</span><span class='o'>]</span> <span class='p'>},</span>
                    <span class='ss'>:field3</span><span class='o'>.</span><span class='n'>in</span> <span class='o'>[</span><span class='s1'>&#39;hello&#39;</span><span class='p'>,</span> <span class='s1'>&#39;world&#39;</span><span class='o'>]</span><span class='p'>)</span>
     <span class='o'>.</span><span class='n'>where</span><span class='p'>(</span><span class='ss'>:field4</span> <span class='o'>=&gt;</span> <span class='sr'>/ohai/</span><span class='p'>,</span> <span class='ss'>:field5</span><span class='o'>.</span><span class='n'>any</span><span class='o'>.</span><span class='n'>gt</span><span class='p'>(</span><span class='mi'>4</span><span class='p'>))</span>
</code></pre></div><hr />
<h3 id="order_byreverse_orderwithout_ordering">order_by()/reverse_order/without_ordering</h3>

<p><code>order_by()</code> allows to specify the ordering in which the documents are returned. Below a couple of examples to show the usage of <code>order_by()</code>:</p>

<ul>
<li><code>order_by(:field1 =&gt; :asc, :field2 =&gt; :desc)</code> orders by field1 ascending first, and then field2 descending. This syntax works because since Ruby 1.9, hashes are ordered.</li>

<li><code>order_by(:field1, :field2)</code> is equivalent to <code>order_by(:field1 =&gt; :asc, :field2 =&gt; :asc)</code></li>

<li><code>order_by { |doc| doc[:field1] + doc[:field2] }</code> sorts by the sum of field1 and field2 ascending.</li>

<li><code>order_by(-&gt;(doc) { doc[:field1] + doc[:field2] } =&gt; :desc)</code> sorts by the sum of field1 and field2 descending.</li>

<li><code>criteria.reverse_order</code> yields criteria with the opposite ordering.</li>

<li><code>criteria.without_ordering</code> yields criteria with no ordering.</li>

<li>The latest specified <code>order_by()</code> wins. For example, <code>order_by(:field1).order_by(:field2)</code> is equivalent to <code>order_by(:field2)</code>.</li>
</ul>

<p>NoBrainer always order by ascending primary keys by default.</p>

<p><code>order_by()</code> will try to use one of your declared indexes for performance when possible. Learn more about indexes in the <a href="/docs/indexes">Indexes</a> section.</p>
<hr />
<h3 id="skipoffsetlimit">skip()/offset()/limit()</h3>

<ul>
<li><code>criteria.skip(n)</code> will skip <code>n</code> documents.</li>

<li><code>criteria.offset(n)</code> is an alias for <code>criteria.skip(n)</code>.</li>

<li><code>criteria.limit(n)</code> limits the number of returned documents to <code>n</code>.</li>
</ul>

<p>When compiling the RQL query, the skip/limit directives are applied at the end of the RQL query, regardless of their position on the criteria.</p>
<hr />
<h3 id="raw">raw</h3>

<ul>
<li><code>criteria.raw</code> will no longer output model instances, but attribute hashes as received from the database.</li>
</ul>
<hr />
<h3 id="unscoped">unscoped</h3>

<ul>
<li><code>criteria.unscoped</code> will disable the default scope.</li>
</ul>
<hr />
<h3 id="eager_load">eager_load()</h3>

<ul>
<li><code>criteria.eager_load(:some_association)</code> eager loads the association. Read more about eager loading in the <a href="/docs/eager_loading">Eager Loading</a> section.</li>
</ul>
<hr />
<h3 id="count">count</h3>

<ul>
<li><code>criteria.count</code> returns the number of documents that matches the criteria.</li>

<li><code>criteria.empty?</code> is an alias for <code>count == 0</code></li>

<li><code>criteria.any?</code> is an alias for <code>count != 0</code> if no block is given. When a block is given, the method call is proxied to <code>to_a</code>.</li>
</ul>
<hr />
<h3 id="update_allreplace_alldelete_alldestroy_all">update_all/replace_all/delete_all/destroy_all</h3>

<ul>
<li><code>criteria.update_all</code> update all documents matching the criteria following the <a href="http://www.rethinkdb.com/api/ruby/#update"><code>r.update()</code></a> semantics.</li>

<li><code>criteria.replace_all</code> replaces all documents matching the criteria following the <a href="http://www.rethinkdb.com/api/ruby/#replace"><code>r.replace()</code></a> semantics.</li>

<li><code>criteria.delete_all</code> deletes all documents matching the criteria following the <a href="http://www.rethinkdb.com/api/ruby/#delete"><code>r.delete()</code></a> semantics.</li>

<li><code>criteria.destroy_all</code> instantiates the models, run the destroy callbacks and deletes the documents. Returns the array of destroyed instances.</li>
</ul>
<hr />
<h3 id="eachto_a">each/to_a</h3>

<ul>
<li><code>criteria.each</code> enumerates over the documents.</li>

<li><code>criteria.to_a</code> returns an array of documents matching the criteria.</li>

<li><code>criteria.some_method_of_array</code> will proxy <code>some_method_of_array</code> to <code>to_a</code></li>
</ul>
<hr />
<h3 id="first_first_last_last_sample">first, first!, last, last!, sample</h3>

<ul>
<li><code>criteria.first</code> returns the first matched document.</li>

<li><code>criteria.last</code> returns the last matched document.</li>

<li><code>criteria.first!</code> returns the first matched document, raises if not found.</li>

<li><code>criteria.last!</code> returns the last matched document, raises if not found.</li>

<li><code>criteria.sample</code> returns a document picked at random from a uniform distribution.</li>

<li><code>criteria.sample(n)</code> returns an array of <code>n</code> documents picked at random from a uniform distribution.</li>
</ul>

<p>The bang flavors raise a <code>NoBrainer::Error::DocumentNotFound</code> exception if not found instead of returning <code>nil</code>. If left uncaught in a Rails controller, a 404 status code is returned.</p>
<hr />
<h3 id="find">find()</h3>

<ul>
<li><code>Model.find(id)</code> is equivalent to <code>Model.where(:id =&gt; id).first!</code>.</li>

<li><code>Model.find?(id)</code> is equivalent to <code>Model.where(:id =&gt; id).first</code>.</li>
</ul>

<p>Note that default scopes still apply.</p>
<hr />
<h3 id="first_or_create_first_or_create">first_or_create, first_or_create!</h3>

<p>See the <a href="/docs/persistence">Persistence</a> section.</p>
<hr />
<h3 id="changes">changes</h3>

<ul>
<li><code>criteria.raw.changes(options={})</code> returns an changefeed similar to <a href="http://rethinkdb.com/api/ruby/changes/"><code>r.changes()</code></a>.</li>
</ul>

<p>Note that you will get raw objects, and not model instances. If you’d like to get regular objects, please make a request on GitHub.</p>
<hr />
<h3 id="min_max_avg_sum">min, max, avg, sum</h3>

<ul>
<li><code>criteria.min(:field)</code> returns a document which has the minimum value of <code>field</code>.</li>

<li><code>criteria.max(:field)</code> returns a document which has the maximum value of <code>field</code>.</li>

<li><code>criteria.avg(:field)</code> returns the average of <code>field</code> values.</li>

<li><code>criteria.sum(:field)</code> returns the sum of <code>field</code> values.</li>
</ul>

<p>Note that you may also pass a lambda expression instead of a field. For example, <code>criteria.min { |doc| doc[&#39;field1&#39;] + doc[&#39;field2&#39;] }</code> returns a document for which <code>field1 + field2</code> is minimum</p>
<hr />
<h3 id="geo_queries">Geo queries</h3>

<ul>
<li>
<p><code>where(:field.near =&gt; circle)</code> returns documents which <code>field</code> is within <code>circle</code>. The <code>circle</code> must be coercible to a <code>NoBrainer::Geo::Circle</code> (c.f. <a href="http://nobrainer.io/docs/types/#geocircle">types</a>). You may pass an additional option <code>:max_results</code> when leveraging indexes with <a href="http://www.rethinkdb.com/api/ruby/get_nearest/"><code>r.get_nearest</code></a>.</p>
</li>

<li>
<p><code>where(:field.intersects =&gt; shape)</code> returns documents which <code>field</code> intersects <code>shape</code>. The <code>shape</code> can be a <code>NoBrainer::Geo::LineString</code>, <code>NoBrainer::Geo::Circle</code>, or <code>NoBrainer::Geo::Polygon</code>.</p>
</li>
</ul>
<hr />
<h3 id="after_find">after_find()</h3>

<ul>
<li><code>criteria.after_find(-&gt;(doc) { puts &quot;Loaded #{doc}&quot; })</code> runs the specified callback whenever a document is instantiated through the criteria.</li>
</ul>

<p>Multiple callbacks can be passed by calling <code>after_find</code> multiple times. <code>after_find</code> accepts lambdas as arguments or blocks.</p>

<p>Calling <code>reload</code> on an instance will not trigger these callbacks again.</p>

<p>Note that <code>Model.after_find().first</code> declares a callback on the model class, which triggers the callback on every fetched instance. Using <code>Model.all.after_find().first</code> only triggers the callback for that specific fetched instance.</p>

<p>The <a href="/docs/callbacks">Callbacks</a> section describes the order in which the <code>after_find</code> callback is executed.</p>

<p>The <code>after_find</code> feature is used internally by the <code>has_many</code> association to set the corresponding reverse <code>belongs_to</code> association.</p>
<hr />
<h3 id="extend">extend()</h3>

<ul>
<li><code>criteria.extend(module, ...)</code> extends the current criteria and any chained criteria with the given modules. Note that a block may also be given to <code>extend()</code>.</li>
</ul>

<h2 id="manipulating_criteria">Manipulating Criteria</h2>

<p>You can merge two criteria with <code>merge()</code> or <code>merge!()</code>:</p>
<div class='highlight'><pre><code class='ruby'><span class='n'>criteria3</span> <span class='o'>=</span> <span class='n'>criteria1</span><span class='o'>.</span><span class='n'>merge</span><span class='p'>(</span><span class='n'>criteria2</span><span class='p'>)</span>
<span class='n'>criteria1</span><span class='o'>.</span><span class='n'>merge!</span><span class='p'>(</span><span class='n'>criteria2</span><span class='p'>)</span>
</code></pre></div>
<p>To retrieve the selecting criteria of a model instance, you may use <code>instance.selector</code>. This selector is used internally and is equivalent to <code>r.table(&#39;models&#39;).get(instance.id)</code>.</p>

      </article>
    </div>

    <div class="clear"></div>

  </div>
</section>


  <footer>
  <div class="grid">
    <div class="unit whole">
      NoBrainer is written and maintained by
      <a href="https://twitter.com/nviennot">Nicolas Viennot</a>.
    </div>
  </div>
</footer>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46753546-1', 'nobrainer.io');
  ga('send', 'pageview');
</script>

</body>
</html>
